
<script  type="text/javascript">

  $( document ).ready(function() {
        $("#ratetemp").val(0);
         getdata();
        toastr.options = {
            "closeButton": false,
            "debug": false,
            "newestOnTop": false,
            "progressBar": false,
            "positionClass": "toast-bottom-right",
            "preventDuplicates": false,
            "onclick": null,
            "showDuration": "300",
            "hideDuration": "1000",
            "timeOut": "5000",
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
            }
   });
 
    function getdata()
    {
       
        $.ajax({
                    type: "GET",
                    contentType: "application/json; charset=utf-8",
                    url: "/api/getsubject",
                    data: "{}",
                    dataType: "json",
                    success: function (data) {
                        $.each( data, function( key, value ) {
                       
                        $("#subcon").append("<div class='col-sm-6 col-md-4'>"+"<div class='box'> <div class='thumbnail'>"+
                        " <img src="+value.pic+" style='height:230px; width:99%;' />"+
                        "<div class='caption'>"+" <h3>"+value.title+"</h3>"+
                        "<p>"+value.description+"</p> "+
                        "<div class='rate'  data-rate-value="+value.rate+" ></br>"+
                        "</div><input value='Rate' class='btn btn-primary' type='button' onclick='SendRatee(\""+value._id+"\")'/>&nbsp;"+
                        "<input value='Delete' class='btn btn-danger' type='button' onclick='Delete(\""+value._id+"\")'/><br>");
                        });
                         $(".rate").rate(options);
                    },
                    error: function (result) {
                        alert("Error");
                    }
                });
                 var options = {
                max_value: 7,
                step_size: 1,
                update_input_field_name: $("#ratetemp"),
              
            }
             
    }
   
    function SendRatee(id,rate)
    {
        var form_data= {
                       "rate":$("#ratetemp").val(),
                       "userid":1,
                       "idsubject":id
                       };
       
      var userId=1;
        $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "/api/AddRate",
                    dataType: "json",
                    data: JSON.stringify(form_data),
                    success: function (data) {
                        if(data.data=="ok")
                        toastr.info('Thank you for Rating')
                        else
                         toastr.error('error')
                    }
        })
    } 
    function Delete(id)
    {   
        var form_data= {
            "id":id
            };
            console.log(form_data);
        $.ajax({
        type: "post",
        contentType: "application/json; charset=utf-8",
        url: "/api/delete",
        dataType: "json",
        data: JSON.stringify(form_data),
        success: function (data) 
        {
                
                if(data.data=="ok")
                {   $("#subcon").empty();
                    getdata();
                    toastr.info('Delete Subject Successfulty')
                   
                }
                else
                {
                    alert('Not complete');
                }
         }, error: function(xhr, ajaxOptions, thrownError)
         {
            alert(xhr.status);
            console.log(thrownError);
         }
     })
    }
</script>
<div class="row" id="subcon">
  {{!-- dataType: "json", --}}
                    {{!-- "idsubject":'1',
                        "userid":'2',
                        "rate":'3' --}}
 <input type="hidden" id="ratetemp">
</div>